-- SilentAim.lua
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local aiming = false
local fovRadius = 100
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 2
fovCircle.NumSides = 64
fovCircle.Radius = fovRadius
fovCircle.Color = Color3.fromRGB(0,255,0)
fovCircle.Filled = false
fovCircle.Visible = false
fovCircle.Transparency = 1

local currentTarget = nil
local conn = nil

local function getClosestTarget()
    local mousePos = UserInputService:GetMouseLocation()
    local closest = nil
    local shortestDist = math.huge
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") then
            local headPos, onScreen = Camera:WorldToViewportPoint(plr.Character.Head.Position)
            if onScreen then
                local dist = (Vector2.new(headPos.X, headPos.Y) - Vector2.new(mousePos.X, mousePos.Y)).Magnitude
                if dist < shortestDist and dist < fovRadius then
                    shortestDist = dist
                    closest = plr.Character.Head
                end
            end
        end
    end
    return closest
end

local function aimLoop()
    currentTarget = getClosestTarget()
    if currentTarget then
        local headPos, onScreen = Camera:WorldToViewportPoint(currentTarget.Position)
        if onScreen then
            local delta = Vector2.new(headPos.X, headPos.Y) - Vector2.new(UserInputService:GetMouseLocation())
            pcall(function()
                mousemoverel(delta.X, delta.Y)
            end)
        end
    end
end

return function(active)
    fovCircle.Visible = active
    if conn then conn:Disconnect() conn=nil end
    if active then
        conn = RunService.RenderStepped:Connect(function()
            aimLoop()
            if fovCircle.Visible then
                local mousePos = UserInputService:GetMouseLocation()
                fovCircle.Position = Vector2.new(mousePos.X, mousePos.Y)
            end
        end)
    end
end
